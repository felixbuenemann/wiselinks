/*
 2012-2019 Igor Alexandrov, Alexey Solilin, Julia Egorova, Alexandr Borisov
 @preserve https://github.com/igor-alexandrov/wiselinks
 2010-2011 Benjamin Arthur Lupton <contact@balupton.com>
 @license New BSD License <http://creativecommons.org/licenses/BSD/>
 2010-2011 Benjamin Arthur Lupton <contact@balupton.com>
 @license New BSD License <http://creativecommons.org/licenses/BSD/>
 Public Domain
 @author Benjamin Arthur Lupton <contact@balupton.com>
 @author James Padolsey <https://gist.github.com/527683>
 Public Domain
 @author Benjamin Arthur Lupton <contact@balupton.com>
 2010-2011 Benjamin Arthur Lupton <contact@balupton.com>
 @license New BSD License <http://creativecommons.org/licenses/BSD/>
*/
(function(){var e;e=function(){function d(){}d.prototype.parse=function(a){return this._get_parser()(a)};d.prototype._get_parser=function(){return null!=this._document_parser?this._document_parser:this._document_parser=this._parser_factory()};d.prototype._parser_factory=function(){var a,f,c,g,l;f=function(c){return(new d).parseFromString(c,"text/html")};a=function(c){var a;a=document.implementation.createHTMLDocument("");a.documentElement.innerHTML=c;return a};c=function(c){var a;a=document.implementation.createHTMLDocument("");
a.open("replace");a.write(c);a.close();return a};try{if(window.DOMParser)return l=f("<html><body><p>test"),f}catch(e){return l=a("<html><body><p>test"),a}finally{if(1!==(null!=l?null!=(g=l.body)?g.childNodes.length:void 0:void 0))return c}};return d}();null==window._Wiselinks&&(window._Wiselinks={});window._Wiselinks.DOMParser=e;e=function(){function d(a,f){this.page=a;this.$form=f}d.prototype.process=function(){var a;a=this;return a._include_blank_url_params()?a.page.load(a._url(),a._target(),a._type()):
a._without_blank_url_params(function(){return a.page.load(a._url(),a._target(),a._type())})};d.prototype._without_blank_url_params=function(a){var f;f=this.$form.find("select:not(:disabled),input:not(:disabled)").filter(function(){return!$(this).val()});f.attr("disabled",!0);a();return f.attr("disabled",!1)};d.prototype._params=function(){var a,f,c,g,d,e;a={};e=this.$form.serializeArray();f=0;for(g=e.length;f<g;f++)c=e[f],"utf8"!==c.name&&(d=-1!==c.name.indexOf("[]",c.name.length-2)?c.name.substr(0,
c.name.length-2):c.name,a[d]=null!=a[d]?a[d]+(","+c.value):c.value);return a};d.prototype._include_blank_url_params=function(){return!0===this.$form.data("include-blank-url-params")};d.prototype._optimize_url_params=function(){return!1!==this.$form.data("optimize-url-params")};d.prototype._type=function(){return"partial"===this.$form.data("push")?"partial":"template"};d.prototype._target=function(){return this.$form.data("target")};d.prototype._url=function(){var a,f,c;var g;if(this._optimize_url_params()){f=
[];g=this._params();for(a in g)c=g[a],f.push(a+"="+encodeURIComponent(c).replace(/%2C/g,","));a=f.join("&")}else a=this.$form.serialize();f=this.$form.attr("action").replace(/\?.*$/,"");0<a.length&&(f+="?"+a);return f};return d}();null==window._Wiselinks&&(window._Wiselinks={});window._Wiselinks.Form=e;e=function(){function d(a,f){this.page=a;this.$link=f}d.prototype.allows_process=function(a){return!(this._cross_origin_link(a.currentTarget)||this._non_standard_click(a))};d.prototype.process=function(){var a;
a="partial"===this.$link.data("push")?"partial":"template";return this.page.load(this.$link.attr("href"),this.$link.data("target"),a)};d.prototype._cross_origin_link=function(a){return this._different_protocol(a)||this._different_host(a)||this._different_port(a)};d.prototype._different_protocol=function(a){return":"===a.protocol||""===a.protocol?!1:location.protocol!==a.protocol};d.prototype._different_host=function(a){return""===a.host?!1:location.host.split(":")[0]!==a.host.split(":")[0]};d.prototype._different_port=
function(a){return!(location.port===a.port||""===location.port&&("80"===a.port||"443"===a.port))};d.prototype._non_standard_click=function(a){return a.metaKey||a.ctrlKey||a.shiftKey||a.altKey};return d}();void 0===window._Wiselinks&&(window._Wiselinks={});window._Wiselinks.Link=e;e=function(){function d(a,f){var c,g;this.$target=a;this.options=f;g=this;this.template_id=(new Date).getTime();this.request_manager=new _Wiselinks.RequestManager(this.options);c=this.$target;this.$target=g._wrap(this.$target);
g._try_target(this.$target,c);History.emulated.pushState&&!0===this.options.html4&&(-1===window.location.href.indexOf("#.")&&!0===this.options.html4_normalize_path&&window.location.pathname!==this.options.html4_root_path)&&(window.location.href=window.location.protocol+"//"+window.location.host+this.options.html4_root_path+"#."+window.location.pathname);History.Adapter.bind(window,"statechange",function(c,a){var f;f=History.getState();return g._template_id_changed(f)?g._call(g._reset_state(f)):g._call(f)});
$(document).on("click","a[data-push], a[data-replace]",function(c){var a;if((a=new _Wiselinks.Link(g,$(this))).allows_process(c))return c.preventDefault(),a.process(),!1});$(document).on("submit","form[data-push], form[data-replace]",function(c){var a;if(a=new _Wiselinks.Form(g,$(this)))return c.preventDefault(),a.process(),!1})}d.prototype.load=function(a,f,c){var g;null==c&&(c="template");"partial"!==c&&(this.template_id=(new Date).getTime());f=null!=f?(g=this._wrap(f),this._try_target(g,f),g.selector||
f):void 0;return History.pushState({timestamp:(new Date).getTime(),template_id:this.template_id,render:c,target:f,referer:window.location.href},document.title,a)};d.prototype.reload=function(){return History.replaceState({timestamp:(new Date).getTime(),template_id:this.template_id,render:"template",referer:window.location.href},document.title,History.getState().url)};d.prototype._call=function(a){var f;f=null!=a.data.target?$(a.data.target):this.$target;return this.request_manager.call(f,a)};d.prototype._template_id_changed=
function(a){return null==a.data.template_id||a.data.template_id!==this.template_id};d.prototype._make_state=function(a,f,c,g){null==c&&(c="template");return{url:a,data:{target:f,render:c,referer:g}}};d.prototype._reset_state=function(a){null==a.data&&(a.data={});a.data.target=null;a.data.render="template";return a};d.prototype._try_target=function(a,f){if(0===a.length&&"exception"===this.options.target_missing)throw Error("[Wiselinks] Target missing: `"+(a.selector||f)+"`");};d.prototype._wrap=function(a){return $(a)};
return d}();void 0===window._Wiselinks&&(window._Wiselinks={});window._Wiselinks.Page=e;e=function(){function d(a){this.options=null!=a?a:{}}d.prototype.call=function(a,f){var c;c=this;if(null!=this.redirected)this.redirected=null;else return c._loading(a,f),$.ajax({url:f.url,headers:{"X-Wiselinks":f.data.render,"X-Wiselinks-Referer":f.data.referer},dataType:"html"}).done(function(g,f,d){return c._html_loaded(a,g,f,d)}).fail(function(g,d,e){return c._fail(a,d,f,e,g.status,g.responseText)}).always(function(g,
d,e){return c._always(a,d,f)})};d.prototype._normalize=function(a){if(null!=a)return a=a.replace(/\/+$/,"")};d.prototype._assets_changed=function(a){return null!=this.options.assets_digest&&this.options.assets_digest!==a};d.prototype._redirect_to=function(a,f,c,g){g&&4>g.readyState&&(g.onreadystatechange=$.noop,g.abort());this.redirected=!0;$(document).trigger("page:redirected",[f,c.data.render,a]);return History.replaceState(c.data,document.title,a)};d.prototype._loading=function(a,f){return $(document).trigger("page:loading",
[a,f.data.render,decodeURI(f.url)])};d.prototype._done=function(a,f,c,g){return $(document).trigger("page:done",[a,f,decodeURI(c.url),g])};d.prototype._html_loaded=function(a,f,c,g){var d,e,h;d=new window._Wiselinks.Response(f,g,a);h=this._normalize(d.url());f=d.assets_digest();if(this._assets_changed(f))return window.location.reload(!0);e=History.getState();null!=h&&h!==this._normalize(e.url)&&this._redirect_to(h,a,e,g);return a.html(d.content()).promise().done(function(g){return function(){g._title(d.title());
g._description(d.description());g._canonical(d.canonical());g._robots(d.robots());g._link_rel_prev(d.link_rel_prev());g._link_rel_next(d.link_rel_next());return g._done(a,c,e,d.content())}}(this))};d.prototype._fail=function(a,d,c,g,e,m){return $(document).trigger("page:fail",[a,d,decodeURI(c.url),g,e,m])};d.prototype._always=function(a,d,c){return $(document).trigger("page:always",[a,d,decodeURI(c.url)])};d.prototype._title=function(a){if(null!=a)return $(document).trigger("page:title",decodeURI(a)),
document.title=decodeURI(a)};d.prototype._description=function(a){if(null!=a)return $(document).trigger("page:description",decodeURI(a)),$('meta[name="description"]').attr("content",decodeURI(a))};d.prototype._canonical=function(a){if(null!=a)return $(document).trigger("page:canonical",decodeURI(a)),$('link[rel="canonical"]').attr("href",decodeURI(a))};d.prototype._robots=function(a){if(null!=a)return $(document).trigger("page:robots",decodeURI(a)),$('meta[name="robots"]').attr("content",decodeURI(a))};
d.prototype._link_rel_prev=function(a){if(null!=a)return $(document).trigger("page:link_rel_prev",decodeURI(a)),$('link[rel="prev"]').attr("href",decodeURI(a))};d.prototype._link_rel_next=function(a){if(null!=a)return $(document).trigger("page:link_rel_next",decodeURI(a)),$('link[rel="next"]').attr("href",decodeURI(a))};return d}();void 0===window._Wiselinks&&(window._Wiselinks={});window._Wiselinks.RequestManager=e;e=function(){function d(a,d,c){this.html=a;this.xhr=d;this.$target=c}d._document_parser=
null;d._get_document_parser=function(){return null!=d._document_parser?d._document_parser:d._document_parser=new window._Wiselinks.DOMParser};d.prototype.url=function(){return this.xhr.getResponseHeader("X-Wiselinks-Url")};d.prototype.assets_digest=function(){return this._is_full_document_response()?$('meta[name="assets-digest"]',this._get_doc()).attr("content"):this.xhr.getResponseHeader("X-Wiselinks-Assets-Digest")};d.prototype.content=function(){return null!=this._content?this._content:this._content=
this._extract_content()};d.prototype.title=function(){return null!=this._title?this._title:this._title=this._extract_title()};d.prototype._extract_title=function(){return this._is_full_document_response()?$("title",this._get_doc()).text():this.xhr.getResponseHeader("X-Wiselinks-Title")};d.prototype.description=function(){return null!=this._description?this._description:this._description=this._extract_description()};d.prototype._extract_description=function(){return this._is_full_document_response()?
$('meta[name="description"]',this._get_doc()).text():this.xhr.getResponseHeader("X-Wiselinks-Description")};d.prototype.canonical=function(){return null!=this._canonical?this._canonical:this._canonical=this._extract_canonical()};d.prototype._extract_canonical=function(){return this._is_full_document_response()?$('link[rel="canonical"]',this._get_doc()).text():this.xhr.getResponseHeader("X-Wiselinks-Canonical")};d.prototype.robots=function(){return null!=this._robots?this._robots:this._robots=this._extract_robots()};
d.prototype._extract_robots=function(){return this._is_full_document_response()?$('meta[name="robots"]',this._get_doc()).text():this.xhr.getResponseHeader("X-Wiselinks-Robots")};d.prototype.link_rel_prev=function(){return null!=this._link_rel_prev?this._link_rel_prev:this._link_rel_prev=this._extract_link_rel_prev()};d.prototype._extract_link_rel_prev=function(){return this._is_full_document_response()?$('link[rel="prev"]',this._get_doc()).text():this.xhr.getResponseHeader("X-Wiselinks-LinkRelPrev")};
d.prototype.link_rel_next=function(){return null!=this._link_rel_next?this._link_rel_next:this._link_rel_next=this._extract_link_rel_next()};d.prototype._extract_link_rel_next=function(){return this._is_full_document_response()?$('link[rel="next"]',this._get_doc()).text():this.xhr.getResponseHeader("X-Wiselinks-LinkRelNext")};d.prototype._extract_content=function(){return this._get_csp_nonce()?this._get_content_node().find("script").attr("nonce",this._get_csp_nonce()).end().html():this._get_content_html()};
d.prototype._get_content_node=function(){var a;if(this._is_full_document_response())return this._get_doc_target_node();a=$(this._get_doc()).find("body");return a.is(":empty")?a.end().find("head"):a};d.prototype._get_content_html=function(){return this._is_full_document_response()?this._get_doc_target_node().html():this.html};d.prototype._get_csp_nonce=function(){return null!=this._csp_nonce?this._csp_nonce:this._csp_nonce=$("meta[name=csp-nonce]").attr("content")};d.prototype._is_full_document_response=
function(){return 1===this._get_doc_target_node().length};d.prototype._get_doc_target_node=function(){return null!=this.$doc_target_node?this.$doc_target_node:this.$doc_target_node=$(this.$target.selector,this._get_doc())};d.prototype._get_doc=function(){return null!=this._doc?this._doc:this._doc=d._get_document_parser().parse(this.html)};return d}();null==window._Wiselinks&&(window._Wiselinks={});window._Wiselinks.Response=e;e=function(){function d(a,d){null==a&&(a=$("body"));this.options=null!=
d?d:{};this._try_jquery();this.options=$.extend(this._defaults(),this.options);this.enabled()&&(this.options.disable_suid&&(History.options.disableSuid=!0),this.page=new _Wiselinks.Page(a,this.options))}d.prototype.enabled=function(){return!History.emulated.pushState||!0===this.options.html4};d.prototype.load=function(a,d,c){null==c&&(c="template");return this.page.load(a,d,c)};d.prototype.reload=function(){return this.page.reload()};d.prototype._defaults=function(){return{disable_suid:!0,html4:!0,
html4_root_path:"/",html4_normalize_path:!0,target_missing:null,assets_digest:$("meta[name='assets-digest']").attr("content")}};d.prototype._try_jquery=function(){if(null==window.jQuery)throw Error("[Wiselinks] jQuery is not loaded");};return d}();window.Wiselinks=e}).call(this);"object"!==typeof JSON&&(JSON={});
(function(){function e(c){return 10>c?"0"+c:c}function d(a){c.lastIndex=0;return c.test(a)?'"'+a.replace(c,function(c){var a=m[c];return"string"===typeof a?a:"\\u"+("0000"+c.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function a(c,f){var e,b,m,u,t=g,q,k=f[c];k&&("object"===typeof k&&"function"===typeof k.toJSON)&&(k=k.toJSON(c));"function"===typeof h&&(k=h.call(f,c,k));switch(typeof k){case "string":return d(k);case "number":return isFinite(k)?String(k):"null";case "boolean":case "null":return String(k);
case "object":if(!k)return"null";g+=l;q=[];if("[object Array]"===Object.prototype.toString.apply(k)){u=k.length;for(e=0;e<u;e+=1)q[e]=a(e,k)||"null";m=0===q.length?"[]":g?"[\n"+g+q.join(",\n"+g)+"\n"+t+"]":"["+q.join(",")+"]";g=t;return m}if(h&&"object"===typeof h)for(u=h.length,e=0;e<u;e+=1)"string"===typeof h[e]&&(b=h[e],(m=a(b,k))&&q.push(d(b)+(g?": ":":")+m));else for(b in k)Object.prototype.hasOwnProperty.call(k,b)&&(m=a(b,k))&&q.push(d(b)+(g?": ":":")+m);m=0===q.length?"{}":g?"{\n"+g+q.join(",\n"+
g)+"\n"+t+"}":"{"+q.join(",")+"}";g=t;return m}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(c){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(c){return this.valueOf()});var f=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
c=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,g,l,m={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},h;"function"!==typeof JSON.stringify&&(JSON.stringify=function(c,d,f){var b;l=g="";if("number"===typeof f)for(b=0;b<f;b+=1)l+=" ";else"string"===typeof f&&(l=f);if((h=d)&&"function"!==typeof d&&("object"!==typeof d||"number"!==typeof d.length))throw Error("JSON.stringify");return a("",{"":c})});
"function"!==typeof JSON.parse&&(JSON.parse=function(c,a){function d(b,c){var g,f,k=b[c];if(k&&"object"===typeof k)for(g in k)Object.prototype.hasOwnProperty.call(k,g)&&(f=d(k,g),void 0!==f?k[g]=f:delete k[g]);return a.call(b,c,k)}var b;c=String(c);f.lastIndex=0;f.test(c)&&(c=c.replace(f,function(b){return"\\u"+("0000"+b.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(c.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return b=eval("("+c+")"),"function"===typeof a?d({"":b},""):b;throw new SyntaxError("JSON.parse");})})();
(function(e,d){var a=e.History=e.History||{};if("undefined"!==typeof a.Adapter)throw Error("History.js Adapter has already been loaded...");a.Adapter={handlers:{},_uid:1,uid:function(d){return d._uid||(d._uid=a.Adapter._uid++)},bind:function(d,c,g){var e=a.Adapter.uid(d);a.Adapter.handlers[e]=a.Adapter.handlers[e]||{};a.Adapter.handlers[e][c]=a.Adapter.handlers[e][c]||[];a.Adapter.handlers[e][c].push(g);d["on"+c]=function(c,d){return function(g){a.Adapter.trigger(c,d,g)}}(d,c)},trigger:function(d,
c,g){g=g||{};d=a.Adapter.uid(d);var e,m;a.Adapter.handlers[d]=a.Adapter.handlers[d]||{};a.Adapter.handlers[d][c]=a.Adapter.handlers[d][c]||[];e=0;for(m=a.Adapter.handlers[d][c].length;e<m;++e)a.Adapter.handlers[d][c][e].apply(this,[g])},extractEventData:function(a,c){return c&&c[a]||d},onDomLoad:function(a){var c=e.setTimeout(function(){a()},2E3);e.onload=function(){clearTimeout(c);a()}}};"undefined"!==typeof a.init&&a.init()})(window);
(function(e,d){var a=e.document,f=e.setInterval||f,c=e.History=e.History||{};if("undefined"!==typeof c.initHtml4)throw Error("History.js HTML4 Support has already been loaded...");c.initHtml4=function(){if("undefined"!==typeof c.initHtml4.initialized)return!1;c.initHtml4.initialized=!0;c.enabled=!0;c.savedHashes=[];c.isLastHash=function(a){var d=c.getHashByIndex();return a===d};c.isHashEqual=function(c,a){c=encodeURIComponent(c).replace(/%25/g,"%");a=encodeURIComponent(a).replace(/%25/g,"%");return c===
a};c.saveHash=function(a){if(c.isLastHash(a))return!1;c.savedHashes.push(a);return!0};c.getHashByIndex=function(a){var d=null;return d="undefined"===typeof a?c.savedHashes[c.savedHashes.length-1]:0>a?c.savedHashes[c.savedHashes.length+a]:c.savedHashes[a]};c.discardedHashes={};c.discardedStates={};c.discardState=function(a,d,e){var f=c.getHashByState(a);c.discardedStates[f]={discardedState:a,backState:e,forwardState:d};return!0};c.discardHash=function(a,d,e){c.discardedHashes[a]={discardedHash:a,backState:e,
forwardState:d};return!0};c.discardedState=function(a){a=c.getHashByState(a);return c.discardedStates[a]||!1};c.discardedHash=function(a){return c.discardedHashes[a]||!1};c.recycleState=function(a){var d=c.getHashByState(a);c.discardedState(a)&&delete c.discardedStates[d];return!0};c.emulated.hashChange&&(c.hashChangeInit=function(){c.checkerFunction=null;var d="",l,m,h,n=Boolean(c.getHash());c.isInternetExplorer()?(l=a.createElement("iframe"),l.setAttribute("id","historyjs-iframe"),l.setAttribute("src",
"#"),l.style.display="none",a.body.appendChild(l),l.contentWindow.document.open(),l.contentWindow.document.close(),m="",h=!1,c.checkerFunction=function(){if(h)return!1;h=!0;var a=c.getHash(),f=c.getHash(l.contentWindow.document);a!==d?(d=a,f!==a&&(m=a,l.contentWindow.document.open(),l.contentWindow.document.close(),l.contentWindow.document.location.hash=c.escapeHash(a)),c.Adapter.trigger(e,"hashchange")):f!==m&&(m=f,n&&""===f?c.back():c.setHash(f,!1));h=!1;return!0}):c.checkerFunction=function(){var a=
c.getHash()||"";a!==d&&(d=a,c.Adapter.trigger(e,"hashchange"));return!0};c.intervalList.push(f(c.checkerFunction,c.options.hashChangeInterval));return!0},c.Adapter.onDomLoad(c.hashChangeInit));c.emulated.pushState&&(c.onHashChange=function(a){a=a&&a.newURL||c.getLocationHref();var d=c.getHashByUrl(a);a=null;if(c.isLastHash(d))return c.busy(!1),!1;c.doubleCheckComplete();c.saveHash(d);if(d&&c.isTraditionalAnchor(d))return c.Adapter.trigger(e,"anchorchange"),c.busy(!1),!1;a=c.extractState(c.getFullUrl(d||
c.getLocationHref()),!0);if(c.isLastSavedState(a))return c.busy(!1),!1;c.getHashByState(a);if(d=c.discardedState(a))return c.getHashByIndex(-2)===c.getHashByState(d.forwardState)?c.back(!1):c.forward(!1),!1;c.pushState(a.data,a.title,encodeURI(a.url),!1);return!0},c.Adapter.bind(e,"hashchange",c.onHashChange),c.pushState=function(a,d,f,h){f=encodeURI(f).replace(/%25/g,"%");if(c.getHashByUrl(f))throw Error("History.js does not support states with fragment-identifiers (hashes/anchors).");if(!1!==h&&
c.busy())return c.pushQueue({scope:c,callback:c.pushState,args:arguments,queue:h}),!1;c.busy(!0);var n=c.createStateObject(a,d,f),p=c.getHashByState(n),r=c.getState(!1),r=c.getHashByState(r),b=c.getHash(),s=c.expectedStateId==n.id;c.storeState(n);c.expectedStateId=n.id;c.recycleState(n);c.setTitle(n);if(p===r)return c.busy(!1),!1;c.saveState(n);s||c.Adapter.trigger(e,"statechange");c.isHashEqual(p,b)||c.isHashEqual(p,c.getShortUrl(c.getLocationHref()))||c.setHash(p,!1);c.busy(!1);return!0},c.replaceState=
function(a,d,f,h){f=encodeURI(f).replace(/%25/g,"%");if(c.getHashByUrl(f))throw Error("History.js does not support states with fragment-identifiers (hashes/anchors).");if(!1!==h&&c.busy())return c.pushQueue({scope:c,callback:c.replaceState,args:arguments,queue:h}),!1;c.busy(!0);var n=c.createStateObject(a,d,f),p=c.getHashByState(n),r=c.getState(!1),b=c.getHashByState(r),s=c.getStateByIndex(-2);c.discardState(r,n,s);p===b?(c.storeState(n),c.expectedStateId=n.id,c.recycleState(n),c.setTitle(n),c.saveState(n),
c.Adapter.trigger(e,"statechange"),c.busy(!1)):c.pushState(n.data,n.title,n.url,!1);return!0});if(c.emulated.pushState&&c.getHash()&&!c.emulated.hashChange)c.Adapter.onDomLoad(function(){c.Adapter.trigger(e,"hashchange")})};"undefined"!==typeof c.init&&c.init()})(window);
(function(e,d){var a=e.console||d,f=e.document,c=e.navigator,g=e.sessionStorage||!1,l=e.setTimeout,m=e.clearTimeout,h=e.setInterval,n=e.clearInterval,p=e.JSON,r=e.alert,b=e.History=e.History||{},s=e.history;try{g.setItem("TEST","1"),g.removeItem("TEST")}catch(u){g=!1}p.stringify=p.stringify||p.encode;p.parse=p.parse||p.decode;if("undefined"!==typeof b.init)throw Error("History.js Core has already been loaded...");b.init=function(a){if("undefined"===typeof b.Adapter)return!1;"undefined"!==typeof b.initCore&&
b.initCore();"undefined"!==typeof b.initHtml4&&b.initHtml4();return!0};b.initCore=function(t){if("undefined"!==typeof b.initCore.initialized)return!1;b.initCore.initialized=!0;b.options=b.options||{};b.options.hashChangeInterval=b.options.hashChangeInterval||100;b.options.safariPollInterval=b.options.safariPollInterval||500;b.options.doubleCheckInterval=b.options.doubleCheckInterval||500;b.options.disableSuid=b.options.disableSuid||!1;b.options.storeInterval=b.options.storeInterval||1E3;b.options.busyDelay=
b.options.busyDelay||250;b.options.debug=b.options.debug||!1;b.options.initialTitle=b.options.initialTitle||f.title;b.options.html4Mode=b.options.html4Mode||!1;b.options.delayInit=b.options.delayInit||!1;b.intervalList=[];b.clearAllIntervals=function(){var a,c=b.intervalList;if("undefined"!==typeof c&&null!==c){for(a=0;a<c.length;a++)n(c[a]);b.intervalList=null}};b.debug=function(){b.options.debug&&b.log.apply(b,arguments)};b.log=function(){var b=!("undefined"===typeof a||"undefined"===typeof a.log||
"undefined"===typeof a.log.apply),c=f.getElementById("log"),d,e,g,h;b?(e=Array.prototype.slice.call(arguments),d=e.shift(),"undefined"!==typeof a.debug?a.debug.apply(a,[d,e]):a.log.apply(a,[d,e])):d="\n"+arguments[0]+"\n";e=1;for(g=arguments.length;e<g;++e){h=arguments[e];if("object"===typeof h&&"undefined"!==typeof p)try{h=p.stringify(h)}catch(l){}d+="\n"+h+"\n"}c?(c.value+=d+"\n-----\n",c.scrollTop=c.scrollHeight-c.clientHeight):b||r(d);return!0};b.getInternetExplorerMajorVersion=function(){var a=
b.getInternetExplorerMajorVersion,c;if("undefined"!==typeof b.getInternetExplorerMajorVersion.cached)c=b.getInternetExplorerMajorVersion.cached;else{c=3;for(var d=f.createElement("div"),e=d.getElementsByTagName("i");(d.innerHTML="\x3c!--[if gt IE "+ ++c+"]><i></i><![endif]--\x3e")&&e[0];);c=4<c?c:!1}return a.cached=c};b.isInternetExplorer=function(){return b.isInternetExplorer.cached="undefined"!==typeof b.isInternetExplorer.cached?b.isInternetExplorer.cached:Boolean(b.getInternetExplorerMajorVersion())};
b.emulated=b.options.html4Mode?{pushState:!0,hashChange:!0}:{pushState:!Boolean(e.history&&e.history.pushState&&e.history.replaceState&&!(/ Mobile\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i.test(c.userAgent)||/AppleWebKit\/5([0-2]|3[0-2])/i.test(c.userAgent))),hashChange:Boolean(!("onhashchange"in e||"onhashchange"in f)||b.isInternetExplorer()&&8>b.getInternetExplorerMajorVersion())};b.enabled=!b.emulated.pushState;b.bugs={setHash:Boolean(!b.emulated.pushState&&"Apple Computer, Inc."===c.vendor&&/AppleWebKit\/5([0-2]|3[0-3])/.test(c.userAgent)),
safariPoll:Boolean(!b.emulated.pushState&&"Apple Computer, Inc."===c.vendor&&/AppleWebKit\/5([0-2]|3[0-3])/.test(c.userAgent)),ieDoubleCheck:Boolean(b.isInternetExplorer()&&8>b.getInternetExplorerMajorVersion()),hashEscape:Boolean(b.isInternetExplorer()&&7>b.getInternetExplorerMajorVersion())};b.isEmptyObject=function(b){for(var a in b)if(b.hasOwnProperty(a))return!1;return!0};b.cloneObject=function(b){b?(b=p.stringify(b),b=p.parse(b)):b={};return b};b.getRootUrl=function(){var b=f.location.protocol+
"//"+(f.location.hostname||f.location.host);f.location.port&&(b+=":"+f.location.port);return b+"/"};b.getBaseHref=function(){var b=f.getElementsByTagName("base"),a=null,a="";1===b.length&&(a=b[0],a=a.href.replace(/[^\/]+$/,""));(a=a.replace(/\/+$/,""))&&(a+="/");return a};b.getBaseUrl=function(){return b.getBaseHref()||b.getBasePageUrl()||b.getRootUrl()};b.getPageUrl=function(){return((b.getState(!1,!1)||{}).url||b.getLocationHref()).replace(/\/+$/,"").replace(/[^\/]+$/,function(b,a,c){return/\./.test(b)?
b:b+"/"})};b.getBasePageUrl=function(){return b.getLocationHref().replace(/[#\?].*/,"").replace(/[^\/]+$/,function(b,a,c){return/[^\/]$/.test(b)?"":b}).replace(/\/+$/,"")+"/"};b.getFullUrl=function(a,c){var d=a,e=a.substring(0,1);c="undefined"===typeof c?!0:c;/[a-z]+\:\/\//.test(a)||(d="/"===e?b.getRootUrl()+a.replace(/^\/+/,""):"#"===e?b.getPageUrl().replace(/#.*/,"")+a:"?"===e?b.getPageUrl().replace(/[\?#].*/,"")+a:c?b.getBaseUrl()+a.replace(/^(\.\/)+/,""):b.getBasePageUrl()+a.replace(/^(\.\/)+/,
""));return d.replace(/\#$/,"")};b.getShortUrl=function(a){var c=b.getBaseUrl(),d=b.getRootUrl();b.emulated.pushState&&(a=a.replace(c,""));a=a.replace(d,"/");return a=("./"+a).replace(/^(\.\/)+/g,"./").replace(/\#$/,"")};b.getLocationHref=function(b){b=b||f;return b.URL===b.location.href?b.location.href:b.location.href===decodeURIComponent(b.URL)?b.URL:b.location.hash&&decodeURIComponent(b.location.href.replace(/^[^#]+/,""))===b.location.hash||-1==b.URL.indexOf("#")&&-1!=b.location.href.indexOf("#")?
b.location.href:b.URL||b.location.href};b.store={};b.idToState=b.idToState||{};b.stateToId=b.stateToId||{};b.urlToId=b.urlToId||{};b.storedStates=b.storedStates||[];b.savedStates=b.savedStates||[];b.normalizeStore=function(){b.store.idToState=b.store.idToState||{};b.store.urlToId=b.store.urlToId||{};b.store.stateToId=b.store.stateToId||{}};b.getState=function(a,c){"undefined"===typeof a&&(a=!0);"undefined"===typeof c&&(c=!0);var d=b.getLastSavedState();!d&&c&&(d=b.createStateObject());a&&(d=b.cloneObject(d),
d.url=d.cleanUrl||d.url);return d};b.getIdByState=function(a){var c=b.extractId(a.url),d;if(!c)if(d=b.getStateString(a),"undefined"!==typeof b.stateToId[d])c=b.stateToId[d];else if("undefined"!==typeof b.store.stateToId[d])c=b.store.stateToId[d];else{for(;c=(new Date).getTime()+String(Math.random()).replace(/\D/g,""),"undefined"!==typeof b.idToState[c]||"undefined"!==typeof b.store.idToState[c];);b.stateToId[d]=c;b.idToState[c]=a}return c};b.normalizeState=function(a){var c;a&&"object"===typeof a||
(a={});if("undefined"!==typeof a.normalized)return a;a.data&&"object"===typeof a.data||(a.data={});c={normalized:!0};c.title=a.title||"";c.url=b.getFullUrl(a.url?a.url:b.getLocationHref());c.hash=b.getShortUrl(c.url);c.data=b.cloneObject(a.data);c.id=b.getIdByState(c);c.cleanUrl=c.url.replace(/\??\&_suid.*/,"");c.url=c.cleanUrl;a=!b.isEmptyObject(c.data);(c.title||a)&&!0!==b.options.disableSuid&&(c.hash=b.getShortUrl(c.url).replace(/\??\&_suid.*/,""),/\?/.test(c.hash)||(c.hash+="?"),c.hash+="&_suid="+
c.id);c.hashedUrl=b.getFullUrl(c.hash);(b.emulated.pushState||b.bugs.safariPoll)&&b.hasUrlDuplicate(c)&&(c.url=c.hashedUrl);return c};b.createStateObject=function(a,c,d){a={data:a,title:c,url:d};return a=b.normalizeState(a)};b.getStateById=function(a){a=String(a);return b.idToState[a]||b.store.idToState[a]||d};b.getStateString=function(a){a={data:b.normalizeState(a).data,title:a.title,url:a.url};return p.stringify(a)};b.getStateId=function(a){return b.normalizeState(a).id};b.getHashByState=function(a){return b.normalizeState(a).hash};
b.extractId=function(b){b=-1!=b.indexOf("#")?b.split("#")[0]:b;return((b=/(.*)\&_suid=([0-9]+)$/.exec(b))?String(b[2]||""):"")||!1};b.isTraditionalAnchor=function(b){return!/[\/\\.]/.test(b)};b.extractState=function(a,c){var d=null,e,f;c=c||!1;(e=b.extractId(a))&&(d=b.getStateById(e));d||(f=b.getFullUrl(a),(e=b.getIdByUrl(f)||!1)&&(d=b.getStateById(e)),d||(!c||b.isTraditionalAnchor(a))||(d=b.createStateObject(null,null,f)));return d};b.getIdByUrl=function(a){return b.urlToId[a]||b.store.urlToId[a]||
d};b.getLastSavedState=function(){return b.savedStates[b.savedStates.length-1]||d};b.getLastStoredState=function(){return b.storedStates[b.storedStates.length-1]||d};b.hasUrlDuplicate=function(a){var c=!1;return c=(c=b.extractState(a.url))&&c.id!==a.id};b.storeState=function(a){b.urlToId[a.url]=a.id;b.storedStates.push(b.cloneObject(a));return a};b.isLastSavedState=function(a){var c=!1;b.savedStates.length&&(a=a.id,c=b.getLastSavedState(),c=c.id,c=a===c);return c};b.saveState=function(a){if(b.isLastSavedState(a))return!1;
b.savedStates.push(b.cloneObject(a));return!0};b.getStateByIndex=function(a){var c=null;return c="undefined"===typeof a?b.savedStates[b.savedStates.length-1]:0>a?b.savedStates[b.savedStates.length+a]:b.savedStates[a]};b.getCurrentIndex=function(){var a=null;return a=1>b.savedStates.length?0:b.savedStates.length-1};b.getHash=function(a){a=b.getLocationHref(a);return b.getHashByUrl(a)};b.unescapeHash=function(a){a=b.normalizeHash(a);return a=decodeURIComponent(a)};b.normalizeHash=function(b){return b.replace(/[^#]*#/,
"").replace(/#.*/,"")};b.setHash=function(a,c){var d;if(!1!==c&&b.busy())return b.pushQueue({scope:b,callback:b.setHash,args:arguments,queue:c}),!1;b.busy(!0);(d=b.extractState(a,!0))&&!b.emulated.pushState?b.pushState(d.data,d.title,d.url,!1):b.getHash()!==a&&(b.bugs.setHash?(d=b.getPageUrl(),b.pushState(null,null,d+"#"+a,!1)):f.location.hash=a);return b};b.escapeHash=function(a){a=b.normalizeHash(a);a=e.encodeURIComponent(a);b.bugs.hashEscape||(a=a.replace(/\%21/g,"!").replace(/\%26/g,"&").replace(/\%3D/g,
"=").replace(/\%3F/g,"?"));return a};b.getHashByUrl=function(a){a=String(a).replace(/([^#]*)#?([^#]*)#?(.*)/,"$2");return a=b.unescapeHash(a)};b.setTitle=function(a){var c=a.title,d;c||(d=b.getStateByIndex(0))&&d.url===a.url&&(c=d.title||b.options.initialTitle);try{f.getElementsByTagName("title")[0].innerHTML=c.replace("<","&lt;").replace(">","&gt;").replace(" & "," &amp; ")}catch(e){}f.title=c;return b};b.queues=[];b.busy=function(a){"undefined"!==typeof a?b.busy.flag=a:"undefined"===typeof b.busy.flag&&
(b.busy.flag=!1);if(!b.busy.flag){m(b.busy.timeout);var c=function(){var a,d;if(!b.busy.flag)for(a=b.queues.length-1;0<=a;--a)d=b.queues[a],0!==d.length&&(d=d.shift(),b.fireQueueItem(d),b.busy.timeout=l(c,b.options.busyDelay))};b.busy.timeout=l(c,b.options.busyDelay)}return b.busy.flag};b.busy.flag=!1;b.fireQueueItem=function(a){return a.callback.apply(a.scope||b,a.args||[])};b.pushQueue=function(a){b.queues[a.queue||0]=b.queues[a.queue||0]||[];b.queues[a.queue||0].push(a);return b};b.queue=function(a,
c){"function"===typeof a&&(a={callback:a});"undefined"!==typeof c&&(a.queue=c);b.busy()?b.pushQueue(a):b.fireQueueItem(a);return b};b.clearQueue=function(){b.busy.flag=!1;b.queues=[];return b};b.stateChanged=!1;b.doubleChecker=!1;b.doubleCheckComplete=function(){b.stateChanged=!0;b.doubleCheckClear();return b};b.doubleCheckClear=function(){b.doubleChecker&&(m(b.doubleChecker),b.doubleChecker=!1);return b};b.doubleCheck=function(a){b.stateChanged=!1;b.doubleCheckClear();b.bugs.ieDoubleCheck&&(b.doubleChecker=
l(function(){b.doubleCheckClear();b.stateChanged||a();return!0},b.options.doubleCheckInterval));return b};b.safariStatePoll=function(){var a=b.extractState(b.getLocationHref());if(!b.isLastSavedState(a))return a||b.createStateObject(),b.Adapter.trigger(e,"popstate"),b};b.back=function(a){if(!1!==a&&b.busy())return b.pushQueue({scope:b,callback:b.back,args:arguments,queue:a}),!1;b.busy(!0);b.doubleCheck(function(){b.back(!1)});s.go(-1);return!0};b.forward=function(a){if(!1!==a&&b.busy())return b.pushQueue({scope:b,
callback:b.forward,args:arguments,queue:a}),!1;b.busy(!0);b.doubleCheck(function(){b.forward(!1)});s.go(1);return!0};b.go=function(a,c){var d;if(0<a)for(d=1;d<=a;++d)b.forward(c);else if(0>a)for(d=-1;d>=a;--d)b.back(c);else throw Error("History.go: History.go requires a positive or negative integer passed.");return b};b.emulated.pushState?(t=function(){},b.pushState=b.pushState||t,b.replaceState=b.replaceState||t):(b.onPopState=function(a,c){var d=!1,d=!1;b.doubleCheckComplete();if(d=b.getHash())return(d=
b.extractState(d||b.getLocationHref(),!0))?b.replaceState(d.data,d.title,d.url,!1):(b.Adapter.trigger(e,"anchorchange"),b.busy(!1)),b.expectedStateId=!1;(d=(d=b.Adapter.extractEventData("state",a,c)||!1)?b.getStateById(d):b.expectedStateId?b.getStateById(b.expectedStateId):b.extractState(b.getLocationHref()))||(d=b.createStateObject(null,null,b.getLocationHref()));b.expectedStateId=!1;if(b.isLastSavedState(d))return b.busy(!1),!1;b.storeState(d);b.saveState(d);b.setTitle(d);b.Adapter.trigger(e,"statechange");
b.busy(!1);return!0},b.Adapter.bind(e,"popstate",b.onPopState),b.pushState=function(a,c,d,f){if(b.getHashByUrl(d)&&b.emulated.pushState)throw Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(!1!==f&&b.busy())return b.pushQueue({scope:b,callback:b.pushState,args:arguments,queue:f}),!1;b.busy(!0);var g=b.createStateObject(a,c,d);b.isLastSavedState(g)?b.busy(!1):(b.storeState(g),b.expectedStateId=g.id,s.pushState(g.id,g.title,g.url),b.Adapter.trigger(e,"popstate"));
return!0},b.replaceState=function(a,c,d,f){if(b.getHashByUrl(d)&&b.emulated.pushState)throw Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(!1!==f&&b.busy())return b.pushQueue({scope:b,callback:b.replaceState,args:arguments,queue:f}),!1;b.busy(!0);var g=b.createStateObject(a,c,d);b.isLastSavedState(g)?b.busy(!1):(b.storeState(g),b.expectedStateId=g.id,s.replaceState(g.id,g.title,g.url),b.Adapter.trigger(e,"popstate"));return!0});if(g)try{b.store=p.parse(g.getItem("History.store"))||
{}}catch(q){b.store={}}else b.store={};b.normalizeStore();b.Adapter.bind(e,"unload",b.clearAllIntervals);b.saveState(b.storeState(b.extractState(b.getLocationHref(),!0)));g&&(b.onUnload=function(){var a,c;try{a=p.parse(g.getItem("History.store"))||{}}catch(d){a={}}a.idToState=a.idToState||{};a.urlToId=a.urlToId||{};a.stateToId=a.stateToId||{};for(c in b.idToState)b.idToState.hasOwnProperty(c)&&(a.idToState[c]=b.idToState[c]);for(c in b.urlToId)b.urlToId.hasOwnProperty(c)&&(a.urlToId[c]=b.urlToId[c]);
for(c in b.stateToId)b.stateToId.hasOwnProperty(c)&&(a.stateToId[c]=b.stateToId[c]);b.store=a;b.normalizeStore();a=p.stringify(a);try{g.setItem("History.store",a)}catch(e){if(e.code===DOMException.QUOTA_EXCEEDED_ERR)g.length&&(g.removeItem("History.store"),g.setItem("History.store",a));else throw e;}},b.intervalList.push(h(b.onUnload,b.options.storeInterval)),b.Adapter.bind(e,"beforeunload",b.onUnload),b.Adapter.bind(e,"unload",b.onUnload));if(!b.emulated.pushState&&(b.bugs.safariPoll&&b.intervalList.push(h(b.safariStatePoll,
b.options.safariPollInterval)),"Apple Computer, Inc."===c.vendor||"Mozilla"===(c.appCodeName||""))&&(b.Adapter.bind(e,"hashchange",function(){b.Adapter.trigger(e,"popstate")}),b.getHash()))b.Adapter.onDomLoad(function(){b.Adapter.trigger(e,"hashchange")})};b.options&&b.options.delayInit||b.init()})(window);
